<%= render PageTitleComponent.new(title: "Account settings") %>

<%= render UserFormComponent.new(user: current_user) %>

<hr class="my-4 border-aoc-gray-darker">

<%= render PageTitleComponent.new(title: "Squad settings") %>

<div class="flex flex-col gap-y-2">
  <% if current_user.squad_id.nil? %>

    <%= form_with model: @squad, url: join_squad_path, class: "flex w-max mx-auto items-end gap-x-2" do |f| %>
      <%= f.number_field :pin, placeholder: "Squad PIN", class: "input w-32" %>

      <%= f.submit "Join squad", class: "button" %>
    <% end %>

    <%= form_with model: @squad, url: create_squad_path, class: "w-max mx-auto" do |f| %>
      <%= f.submit "Create new squad", class: "button w-64" %>
    <% end %>

  <% else %>

    <p class="my-4">Members: <%= safe_join @squad.users.map { |user| link_to user.username, profile_path(user.uid), class: "strong hover:text-gold" }, ", " %></p>

    <%= form_with model: @squad, url: update_squad_path(@squad), class: "flex flex-col w-max mx-auto items-end gap-y-2" do |f| %>
      <div class="flex flex-col gap-y-1 sm:flex-row sm:items-center sm:gap-x-3">
        <%= f.label :pin %>
        <%= f.number_field :pin, value: @squad.pin, class: "input", disabled: true %>
      </div>

      <div class="flex flex-col gap-y-1 sm:flex-row sm:items-center sm:gap-x-3">
        <%= f.label :name %>
        <%= f.text_field :name, value: @squad.name, class: "input" %>
      </div>

      <%= f.submit "Save", class: "button" %>
    <% end %>

    <%= button_to "Leave squad", leave_squad_path, method: :delete, data: { turbo: false }, class: "flex w-max mx-auto button-red" %>

  <% end %>
</div>

<hr class="my-4 border-aoc-gray-darker">

<%= render PageTitleComponent.new(title: "Slack integration") %>

<p class="my-4">
  To facilitate support and communication (e.g. for the rewards), you can link your Le Wagon Slack account with the
  platform. You also might access to other cool features ðŸ‘€
</p>

<div class="w-max mx-auto">
  <% if current_user.linked_slack? %>

    <div class="flex items-center gap-x-3">
      <span>You are linked, <%= link_to "@#{current_user.slack_username}", current_user.slack_deep_link, class: "link-slack" %>!</span>
      <%= button_to "Unlink me", user_slack_omniauth_remove_path, method: :delete, data: { turbo: false }, class: "flex w-max mx-auto button-red" %>
    </div>

  <% else %>

    <%= button_to(
          user_slack_openid_omniauth_authorize_path,
          data: { turbo: false, controller: "disable-link", action: "disable-link#now" },
          class: "button-slack"
        ) do %>
      Link Slack account <i class="fab fa-slack"></i>
    <% end %>

  <% end %>
</div>

<hr class="my-4 border-aoc-gray-darker">

<%= render PageTitleComponent.new(title: "Referral") %>

<p class="my-4">
  When you share the event to your friends, ask them to add this referral code during the setup. This will boost your
  <%= link_to "aura", patrons_path, class: "strong hover:text-gold" %>.
</p>

<div class="my-4 flex flex-col justify-center gap-y-1 sm:flex-row sm:items-center sm:gap-x-3">
  <input type="text" value="<%= current_user.referral_code %>" class="input" disabled autocomplete="off">

  <button
    class="button"
    data-controller="clipboard"
    data-action="click->clipboard#copy"
    data-clipboard-content-value="<%= current_user.referral_code %>">
    Copy code
  </button>

  <button
    class="button"
    data-controller="clipboard"
    data-action="click->clipboard#copy"
    data-clipboard-content-value="<%= "#{request.base_url}/?referral_code=#{current_user.referral_code}" %>">
    Copy invite link
  </button>
</div>

<% if @referees.any? %>
  <p class="my-4">
    You already referred <%= pluralize(@referees.count, "user") %>:
    <%= safe_join @referees.map { |user| link_to user.username, profile_path(user.uid), class: "strong hover:text-gold" }, ", " %>
  </p>
<% end %>
