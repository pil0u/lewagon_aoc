<%= render PageTitleComponent.new(title: "Account settings") %>

<%= form_with model: current_user, url: settings_path, class: "my-4 flex flex-col w-max mx-auto items-end gap-y-2" do |f| %>

  <div class="flex flex-col gap-y-1 sm:flex-row sm:items-center sm:gap-x-3">
    <%= f.label :username %>
    <%= f.text_field :username, value: current_user.username, class: "input" %>
  </div>

  <div class="flex flex-col gap-y-1 sm:flex-row sm:items-center sm:gap-x-3">
    <%= f.label :aoc_id %>
    <%= f.number_field :aoc_id, value: current_user.aoc_id, min: 1, class: "input disabled", disabled: true %>
  </div>

  <div class="flex flex-col gap-y-1 sm:flex-row sm:items-center sm:gap-x-3">
    <%= f.label :batch_number, "Batch #" %>
    <%= f.number_field :batch_number, value: current_user.batch&.number, min: 1, class: "input" %>
  </div>

  <div class="flex flex-col gap-y-1 sm:flex-row sm:items-center sm:gap-x-3">
    <%= f.label :city_name, "City" %>
    <%= f.collection_select(:city_id, City.order(:name), :id, :name, { prompt: "", selected: current_user.city_id }, class: "input") %>
  </div>

  <div class="flex items-center gap-x-3 w-48 sm:w-fit">
    <%= f.label :entered_hardcore, "Join the Ladder of Insanity" %>
    <%= f.check_box :entered_hardcore, checked: current_user.entered_hardcore, class: "focus:no-ring", data: {
          controller: "check-alert",
          check_alert_target: "checkbox",
          action: "change->check-alert#ping",
          check_alert_message_value: "The Ladder of Insanity is opt-in. By December 8th, your choice will be immutable.\n\nIf you decide to join, you will appear in the specific ranking and be eligible to its rewards. However, you will lose eligibility to the rewards of the casual ranking."
        } %>
  </div>

  <%= f.submit "Save", class: "button" %>
<% end %>

<hr class="my-4 border-aoc-gray-darker">

<%= render PageTitleComponent.new(title: "Squad settings") %>

<% if current_user.squad_id.nil? %>

  <%= form_with model: @squad, url: join_squad_path, class: "my-4 flex w-max mx-auto items-end gap-x-2" do |f| %>
    <%= f.number_field :pin, placeholder: "Squad PIN", class: "input w-32" %>

    <%= f.submit "Join squad", class: "button" %>
  <% end %>

  <%= form_with model: @squad, url: create_squad_path, class: "my-4 w-max mx-auto" do |f| %>
    <%= f.submit "Create new squad", class: "button w-64" %>
  <% end %>

<% else %>

  <p class="my-4">Members: <%= @squad.users.pluck(:username).join(", ") %></p>

  <%= form_with model: @squad, url: update_squad_path(@squad), class: "my-4 flex flex-col w-max mx-auto items-end gap-y-2" do |f| %>
    <div class="flex flex-col gap-y-1 sm:flex-row sm:items-center sm:gap-x-3">
      <%= f.label :pin %>
      <%= f.number_field :pin, value: @squad.pin, class: "input", disabled: true %>
    </div>

    <div class="flex flex-col gap-y-1 sm:flex-row sm:items-center sm:gap-x-3">
      <%= f.label :name %>
      <%= f.text_field :name, value: @squad.name, class: "input" %>
    </div>

    <%= f.submit "Save", class: "button" %>
  <% end %>

  <%= button_to "Leave squad", leave_squad_path, method: :delete, data: { turbo: false }, class: "my-4 flex w-max mx-auto button-red" %>

<% end %>
